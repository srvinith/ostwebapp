{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <title>OSTWebApp</title>
</head>
<body>
   <div class="container-fluid">
   <div class="home-con">
    <div class="top-row">
        <div class="customer-name-board">
            <h4>{{wish}}</h4>
            <h2>{{name}}</h2>
        </div>
       <div class="end-nav">
        <div class="profile-img">
            {%if profile == "NULL"%}
            <img src="{% static 'images/defalut-profile.svg' %}" alt="profile-img" class="img-fluid">
            {%else%}
            <img src="{{profile}}" alt="profile-img" class="img-fluid">
            {%endif%}
        </div>
       </div>
    </div>
    <div class="center-nav">
        <div class="main-nav">
            <div class="">
                <img src="{% static 'images/home-icon.svg' %}" alt="home" class="img-fluid">
            </div>
            <div class="">
                <img src="{% static 'images/device-icon.svg' %}" alt="home" class="img-fluid">
            </div>
            <div class="">
                <img src="{% static 'images/rooms.svg' %}" alt="home" class="img-fluid">
            </div>
            <div class="">
                <img src="{% static 'images/schedule-icon.svg' %}" alt="home" class="img-fluid">
            </div>
            <div class="">
                <img src="{% static 'images/scenes-icon.svg' %}" alt="home" class="img-fluid">
            </div>

            <div class="logout">
                <img src="{% static 'images/logout-icon.svg' %}" alt="logout-icon" class="img-fluid">
            </div>
        </div>

    </div>

    <div class="bottom-con">
        <div class="main-device-con">
            <label for="check" class="device-con offlightcon">
                <div class="text-center py-4">
                    <!-- <img src="{% static 'images/bulb.svg' %}" alt="offlight" class="img-fluid onlightcon"> -->
                    <img src="{% static 'images/onlight.svg' %}" alt="offlight" class="img-fluid onlightcon">
                    <div class="btn-border">
                        {{name}}
                    </div>
                </div>
                </label>
                {% for id,name,type in alldevice %}
                <form action="/lightpage/" method="post" class="lightForm">
                    {% csrf_token %}
                    <button type="button" name="homeidlight" value="{{id}}" class="homeidButton">{{ name }}-{{type}}</button>
                    <span id="{{id}}"></span>
                </form>
                {% endfor %}
        </div>
    </div>
   </div>
   </div>

<!-- script start=== -->
<script src="{% static ' js' %}"></script>
   <script src="{% static 'js/bootstrap.bundle.js' %}"></script>
   <script src="{% static 'js/bootstrap.min.js' %}"></script>
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

   <!-- <script>
    function updateState2() {
            $.ajax({
                url: "/get_state/",
                type: 'GET'
            })
                .done(response => {
                    const data = response
                    light_state = data["light_state"];
                    light_id= data["light_id"]
                    if (light_id.length === light_state.length) {
                        for (var i = 0; i < light_id.length; i++) {
                            var id = light_id[i];
                            var state = light_state[i];
                            console.log(state)
                            document.getElementById(id).innerText = state
                            console.log("Light ID: " + id + ", Light State: " + state);
                        }
                    } else {
                        console.log("The two lists have different lengths.");
                    }
                });
        }
    $(document).ready(function() {
        updateState2();
        setInterval(updateState2, 1000);
    });
   </script> -->
   <script>
    $(document).ready(function () {
    function submitForm(homeid) {
        var formData = {
            'homeidlight': homeid,
            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
        };

        $.ajax({
            type: 'POST',
            url: '/get_state/',
            data: formData,
            success: function (data) {
                document.getElementById(data.light_id).innerText = data.light_state;
            },
            error: function (xhr, status, error) {
                console.log('Error:', error);
            }
        });
    }

    $('.homeidButton').each(function () {
        var homeid = $(this).val();
        setInterval(function () {
            submitForm(homeid);
            }, 1000);
        });
    });
</script>
</body>
</html>